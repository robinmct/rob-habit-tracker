<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sign In â€¢ Habit Tracker</title>
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="/styles.css">
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet"></noscript>
</head>
<body class="auth">
<div class="login-card">
  <h1>Sign In</h1>
  <div id="gateStatus" class="muted"></div>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <div class="actions">
    <button id="emailSignIn">Sign in</button>
    <button id="googleLogin">Sign in with Google</button>
  </div>
  <div class="muted">New here? <a href="/register/">Create Account Here</a></div>
</div>
<div id="toast" class="toast" role="alert" aria-live="polite"></div>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
<script>
const FIREBASE_CONFIG = window.FIREBASE_CONFIG || {
  apiKey: "AIzaSyAwxkDFl2RkAowEauD9-G72F3ZbEgQSgs4",
  authDomain: "habit-tracker-71b2e.firebaseapp.com",
  projectId: "habit-tracker-71b2e",
  storageBucket: "habit-tracker-71b2e.firebasestorage.app",
  messagingSenderId: "22045425557",
  appId: "1:22045425557:web:53f800e6b16ebc44ad009c",
  measurementId: "G-B3QKE7EHY5"
};
firebase.initializeApp(FIREBASE_CONFIG);
const auth=firebase.auth();
const gateStatus=document.getElementById('gateStatus');
const emailInput=document.getElementById('email');
const passInput=document.getElementById('password');
const emailSignInBtn=document.getElementById('emailSignIn');
const googleLoginBtn=document.getElementById('googleLogin');
const toastEl=document.getElementById('toast');
const card=document.querySelector('.login-card');

function mapAuthError(err){const code=(err&&err.code)||'';switch(code){
  case 'auth/invalid-email': return 'Invalid email format';
  case 'auth/user-not-found': return 'No account found for this email';
  case 'auth/wrong-password': return 'Password incorrect';
  case 'auth/weak-password': return 'Password is too weak';
  case 'auth/email-already-in-use': return 'Email already in use';
  case 'auth/network-request-failed': return 'Network error, try again';
  case 'auth/too-many-requests': return 'Too many attempts, please wait';
  case 'auth/invalid-credential': return 'Sign-in credential expired or invalid. Please try again';
  case 'auth/popup-closed-by-user': return 'Sign-in was cancelled';
  case 'auth/popup-blocked': return 'Popup blocked, allow popups';
  default: return (err&&err.message)||'Something went wrong';
}}
function showToast(msg){toastEl.textContent=msg;toastEl.classList.add('show');setTimeout(()=>{toastEl.classList.remove('show')},4000)}
function showFail(err){const msg=mapAuthError(err);gateStatus.textContent=msg;showToast(msg);card.classList.add('error');setTimeout(()=>card.classList.remove('error'),300)}

emailSignInBtn.onclick=()=>{const email=(emailInput.value||'').trim();const pass=passInput.value||'';auth.signInWithEmailAndPassword(email,pass).catch(err=>{console.error('Email sign-in failed:',err);showFail(err)})};
googleLoginBtn.onclick=()=>{const provider=new firebase.auth.GoogleAuthProvider();provider.setCustomParameters({prompt:'select_account'});auth.useDeviceLanguage();auth.signInWithPopup(provider).catch(err=>{console.error('Google sign-in failed:',err);if(err && (err.code==='auth/popup-blocked' || err.code==='auth/popup-closed-by-user')){auth.signInWithRedirect(provider);} else {showFail(err);} })};

auth.onAuthStateChanged(u=>{ if(u){ window.location.replace('/index/'); } });
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').catch(() => {});
  });
}
</script>
</body>
</html>